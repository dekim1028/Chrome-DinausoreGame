<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공룡 게임</title>
    <style>
        body{
            margin: 0px;
        }
        .dns{
            height:100px;
            position: absolute;
            top: 400px;
            left: 300px;
            transition: 0.3s;
        }
        .back{
            position: absolute;
            top: 480px;
        }
    </style>

    <script>

        function init(){
            
            var intervalID = null;
            //스페이스바 누르면 점프
            document.onkeydown=function(e){  

                const DNS = document.querySelector(".dns");
                if(e.which == 32 && window.getComputedStyle(DNS).top == "400px"){ //바닥에 있을 떄만 점프
                    
                    if(intervalID != null){
                        clearInterval(intervalID);
                    }
                    
                    document.getElementById("DNS").src="./image/DNS_3.png";
                    DNS.style.top="200px";

                    setTimeout(function(){
                        DNS.style.top="400px";
                        intervalID = move();
                    },300);

                    
                }  
            }  
        }

        function move(){
            var pos = 0;
            var DNSArr = ["./image/DNS_1.png","./image/DNS_2.png"];
            var intervalID = setInterval(function(){
                document.getElementById("DNS").src=DNSArr[pos];
                pos == 0?pos=1:pos=0;
            },2)

            return intervalID;
        }

        var img = new Image();

        img.src = './image/ground.png';
        var CanvasXSize = 800;
        var CanvasYSize = 200;
        var speed = 20; // 값이 작을 수록 빨라진다
        var scale = 1.05;
        var y = -4.5; // 수직 옵셋

        // 주요 프로그램
        var dx = 0.75;
        var imgW;
        var imgH;
        var x = 0;
        var clearX;
        var clearY;
        var ctx;
        
        img.onload = function() {
            imgW = img.width*scale;
            imgH = img.height*scale;
            if (imgW > CanvasXSize) { x = CanvasXSize-imgW; } // 캔버스보다 큰 이미지
            if (imgW > CanvasXSize) { clearX = imgW; } // 캔버스보다 큰 이미지
            else { clearX = CanvasXSize; }
            if (imgH > CanvasYSize) { clearY = imgH; } // 캔버스보다 큰 이미지
            else { clearY = CanvasYSize; }
            // 캔버스 요소 얻기
            ctx = document.getElementById('canvas').getContext('2d');
            // 새로 그리기 속도 설정
            return setInterval(draw, speed);
        }

        function draw() {
            // 캔버스를 비운다
            ctx.clearRect(0,0,clearX,clearY);

            if(x<-3650){ x = CanvasXSize-imgW; }            
            // 재설정, 처음부터 시작
            if (x > (CanvasXSize)) { x = CanvasXSize-imgW; }
            // 추가 이미지 그리기
            if (x < (CanvasXSize-imgW)) { ctx.drawImage(img,imgW+x-2,y,imgW,imgH); }

            // 이미지 그리기
            ctx.drawImage(img,x,y,imgW,imgH);
            // 움직임 정도
            x -= dx;
        }

        window.onload = function(){
            init();
        }

    </script>
</head>
<body>
    <div>
        <img id="DNS" class="dns" src="./image/DNS_3.png">
    </div>

    <canvas id="canvas" class="back" style="width:100%;height:250px;"></canvas>  
</body>
</html>